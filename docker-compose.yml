version: '3'

services:

  vapor-ci:
    image: ghcr.io/abenevaut/vapor-ci:${TAG_VAPOR_CI:-latest}
    build:
      context: ./vapor-ci
      cache_from:
        - ghcr.io/abenevaut/vapor-ci:latest
      args:
        - VAPOR_VERSION=${VAPOR_VERSION}
        - VAPOR_PLATFORM=${VAPOR_PLATFORM}
        - COMPOSER_HASH=${COMPOSER_HASH}

  vapor-nginx:
    image: ghcr.io/abenevaut/vapor-nginx:${TAG_VAPOR_NGINX:-latest}
    build:
      context: ./vapor-nginx
      cache_from:
        - ghcr.io/abenevaut/vapor-nginx:latest
      args:
        - VAPOR_VERSION=${VAPOR_VERSION}
        - VAPOR_PLATFORM=${VAPOR_PLATFORM}

  vapor-roadrunner:
    image: ghcr.io/abenevaut/vapor-roadrunner:${TAG_VAPOR_ROADRUNNER:-latest}
    platform: linux/amd64,linux/arm64v8
    build:
      context: ./vapor-roadrunner
      cache_from:
        - ghcr.io/abenevaut/vapor-roadrunner:latest
      args:
        - VAPOR_VERSION=${VAPOR_VERSION}
        - VAPOR_PLATFORM=${VAPOR_PLATFORM} # linux/amd64 , linux/arm64v8
